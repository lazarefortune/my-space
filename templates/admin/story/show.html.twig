{% extends "layouts/admin.html.twig" %}

{% block stylesheets %}
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-lite.min.js"></script>
{% endblock %}

{% block site_content %}

	<div class="row">

		<div class="col-md-8 mx-auto">
		{% include 'layouts/flash-messages.html.twig' %}
			{% if app.user.idUser != story.idUser.idUser and story.trash == true %}
				<div class="alert alert-info">
					Cette story a été supprimé temporairement par son auteur.
				</div>
			{% else %}
				<div class="d-flex justify-content-around">
					<a href="{{ path('story_create') }}" class="btn btn-sm btn-primary shadow mt-2 mb-4">
						Ajouter une story
						<i class="fas fa-plus"></i>
					</a>
					{% if app.user.idUser == story.idUser.idUser %}
						{% if story.trash == false %}

							<a href="{{ path('story_edit', {storyId: story.id}) }}" class="btn btn-sm btn-warning shadow mt-2 mb-4">
								Modifier
								<i class="fas fa-edit"></i>
							</a>


							<!-- Fin Suppression modal -->

							<!-- Button delete modal -->
							<button data-toggle="modal" data-target="#deleteStory" class="btn btn-sm btn-danger shadow mt-2 mb-4">
								Supprimer
								<i class="fas fa-trash"></i>
							</button>
							{# <button type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#deleteStory">
								Supprimer
								<i class="fas fa-trash"></i>
							</button> #}

							<!-- Modal -->
							<div class="modal fade" id="deleteStory" tabindex="-1" role="dialog" aria-labelledby="deleteStoryLabel" aria-hidden="true">
								<div class="modal-dialog" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="deleteStoryLabel">Suppression de la story n°
												{{ story.id }}</h5>
											<button type="button" class="close" data-dismiss="modal" aria-label="Close">
												x
											</button>
										</div>
										<div class="modal-body">
											<p class="modal-text">
												Souhaitez vous vraiment supprimer cette story ?
											<br>
											(Elle sera mise en corbeille)
											<hr>
											{% if story.statut != "privee" %}
												Elle ne sera plus accessible
												<br>
												<span class="text-info">Information :
												</span>
												<br>
												Cette publication est en mode
												<strong>
													{{ story.statut }}</strong>, vous pouvez la mettre en
												<strong>privée</strong>
												et ainsi être visible uniquement par vous.
											</strong>
										{% endif %}
											</p>
										</div>
										<div class="modal-footer">
											<button class="btn" data-dismiss="modal">
												<i class="flaticon-cancel-12"></i>
												Annuler</button>
											<a href="{{ path('story_move_to_trash', {storyId: story.id}) }}" class="btn btn-warning">
											Mettre à la corbeille
											<i class="fas fa-trash"></i>
										</a>
										</div>
									</div>
								</div>
							</div>
							

						<a href="{{ path('story_my') }}" class="btn btn-sm btn-secondary shadow mt-2 mb-4">
							Liste des stories
							<i class="fas fa-arrow-right"></i>
						</a>
					{% else %}
						<a href="{{ path('story_move_to_trash', {storyId: story.id}) }}" class="btn btn-sm btn-warning shadow mt-2 mb-4">
							Restaurer
							<i class="fas fa-trash-restore"></i>
						</a>

						<!-- Button delete modal -->
						<button data-toggle="modal" data-target="#deletePermentlyStory" class="btn btn-sm btn-danger shadow mt-2 mb-4">
							Supprimer définitivement
							<i class="fas fa-trash"></i>
						</button>

						<!-- Modal -->
						<div class="modal fade" id="deletePermentlyStory" tabindex="-1" role="dialog" aria-labelledby="deletePermentlyStoryLabel" aria-hidden="true">
							<div class="modal-dialog" role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title" id="deleteStoryLabel">Suppression de la story n°
												{{ story.id }}</h5>
											<button type="button" class="close" data-dismiss="modal" aria-label="Close">
												x
											</button>
										</div>
										<div class="modal-body">
											<p>Souhaitez vous vraiment supprimer cette story ?
										<br>
										Cette action est irréversible.
										<hr></p>
										</div>
										<div class="modal-footer">
											<button class="btn" data-dismiss="modal">
												<i class="flaticon-cancel-12"></i>
												Annuler</button>
											<a href="{{ path('story_delete', {storyId: story.id}) }}" class="btn btn-danger">
											Supprimer définitivement
											<i class="fas fa-trash"></i>
										</a>
										</div>
									</div>
								</div>
							
						</div>
						<a href="{{ path('story_trash') }}" class="btn btn-sm btn-secondary shadow mt-2 mb-4">
							Corbeille
							<i class="fas fa-arrow-right"></i>
						</a>
					{% endif %}

				{% else %}
					<a href="{{ path('story_index') }}" class="btn btn-sm btn-secondary shadow mt-2 mb-4">
						Liste des stories
						<i class="fas fa-arrow-right"></i>
					</a>
				{% endif %}

			</div>

			<article class="card shadow mt-4 p-3 mx-auto">
				<h4 class="font-weight-bold">
					{{ story.title }}
				</h4>
				<p class="mb-0 text-info">
					<span class="badge badge-{{ story.statut == 'privee' ? 'danger' : 'success' }}">
						<i class="fas fa-{{ story.statut == 'privee' ? 'lock' : 'globe-europe' }}"></i>
						{{ story.statut }}
					</span>
					<br>
					Ecrit par :
					<span class="font-italic font-weight-bold">
						{% if app.user.idUser == story.idUser.idUser %}
							Vous
							{% if story.statut == "public_anonyme" %}
								(En anonyme)
							{% endif %}
						{% else %}
							{% if story.statut == "public_anonyme" %}
								un inconnu
							{% else %}
								{{ story.idUser.nom }}
								{{ story.idUser.prenom }}
							{% endif %}
						{% endif %}

					</span>
				</p>
				<p class="text-info">
					Date :
					<span class=" font-weight-bold">
						{% if story.createdAt | date("m/d/Y") == "now" | date("m/d/Y") %}
							Aujourd'hui à
							{{ story.createdAt|date("H:i:s") }}
						{% elseif story.createdAt | date("m/d/Y") == "yesterday" | date("m/d/Y") %}
							Hier à
							{{ story.createdAt|date("H:i:s") }}
						{% else %}
							(Le
							{{ story.createdAt|date("d/m/Y") }}
							à
							{{ story.createdAt|date("H:i:s") }}
							)
						{% endif %}
					</span>
				</p>

				<p class="mt-4 text-justify">
					{{ story.description|raw }}
				</p>

			</article>

			<div class="mt-2 mb-5">
				<h4 class=" font-weight-bold mt-5 mb-3"> <i class="fas fa-comment-dots"></i> Commentaires :</h4>
				
				<div class="mt-4">
					{{ form_start( formCommentary ) }}
					{# <div class="form-group mt-4">
															<label for="commentary">Laisser un commentaire</label>
															<textarea name="" class="form-control" id="" cols="30" rows="5"></textarea>
														</div> #}
						{# <button type="submit" class="btn btn-primary">Laisser mon commentaire <i class="fas fa-paper-plane"></i></button> #}
						{# {% do formCommentary.publier.setRendered %} #}
					{{ form_end( formCommentary ) }}
				</div>

				<ul class="list-group">
					{% for commentary in commentaries %}
						<li class="list-group-item my-3">
							{{ commentary.content }}
							<br>
							<small>
								{{ story.createdAt|date("d/m/Y") }}
								à
								{{ story.createdAt|date("H:i:s") }}
								de
								<b>{{ commentary.user.nom }}
									{{ commentary.user.prenom }}</b>
							</small>
							{% if commentary.user.idUser == app.user.idUser  %}
								<a href="" class="btn btn-sm btn-secondary">
									<i class="fas fa-edit"></i>
								</a>
							{% endif %}
						</li>
					{% endfor %}
				</ul>

				
			</div>

		{% endif %}
	</div>

</div>{% endblock %}
